{% extends "gateway/base.html" %}

{% block h1_title %}
  Management Dashboard
{% endblock %}

{% block content %}
<div class="row">
  <div class="col-md-12">
    <div class="box box-primary">
      <div class="box-header with-border">
        <h2 class="box-title">Applications</h2>
      </div>
      <div class="box-body">
        {% if applications %}
          {% for app in applications %}
            <div class="application">
              <a href="{% url 'applications-detail' pk=app.id %}">
                <div class="col-md-12">
                  <div class="col-md-4">
                    <p class="box-title">{{ app.name }}</p>
                  </div>
                  <div class="col-md-4">
                    <p>{{app.serviceregistry_set.all|length}} services</p>
                  </div>
                  <div class="col-md-4 text-right">
                    {% include 'gateway/health_check_label.html' with status=app.health_check_status %}
                    {% include 'gateway/active_label.html' with status=app.is_active %}
                  </div>
                </div>
              </a>
            </div>
          {% endfor %}
        {% else %}
          <p>No applications are configured.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-md-12">
    <div class="box box-primary">
      <div class="box-header with-border">
        <h2 class="box-title">Recent Errors</h2>
      </div>
      <div class="box-body">
        {% if recent_errors %}
          {% for result in recent_errors %}
            <div class="error">
                <div class="col-md-12">
                  <div class="col-md-4">
                    {% if result.service %}
                    <a href="{% url 'services-detail' pk=result.service.id %}">
                      <p class="service-title">{{result.service.name}}</p>
                    </a>
                    {% else %}
                    <p class="service-title">no service</p>
                    {% endif %}
                    <p>{{result.task_result.date_done|date:"SHORT_DATETIME_FORMAT"}}</p>
                  </div>
                  <div class="col-md-8">
                    <a href="{% url 'results-detail' pk=result.id %}">
                      <p>
                        {% for e in result.error_messages %}{{e}}{% endfor %}
                      </p>
                    </a>
                  </div>
                </div>
            </div>
          {% endfor %}
        {% else %}
          <p>No recent errors.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
